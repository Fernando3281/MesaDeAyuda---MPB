<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
    <head th:replace="~{layout/plantilla :: head}">
        <title>Centro de Soporte</title>
        <meta charset="UTF-8"/>
    </head>
    <body>
        <section th:fragment="dashboard-reportes">
            <div class="dashboard-container">
                <div class="dashboard-header">
                    <h1>Dashboard de Reportes</h1>
                    <div class="last-update" id="lastUpdate">Última actualización: <span id="lastUpdateTime">Cargando...</span></div>
                </div>

                <!-- Estadísticas principales -->
                <div class="stats-grid">
                    <div class="stat-card card-total">
                        <div class="stat-title">Total Tickets</div>
                        <div class="stat-value" id="totalTickets" th:text="${totalTickets}">0</div>
                        <div class="small-text">Todos los tickets registrados en el sistema</div>
                    </div>
                    <div class="stat-card card-open">
                        <div class="stat-title">Tickets Abiertos</div>
                        <div class="stat-value" id="ticketsAbiertos" th:text="${ticketsAbiertos}">0</div>
                        <div class="small-text">Tickets nuevos esperando de asignacion y respuesta</div>
                    </div>
                    <div class="stat-card card-pending">
                        <div class="stat-title">Tickets Pendientes</div>
                        <div class="stat-value" id="ticketsPendientes" th:text="${ticketsPendientes}">0</div>
                        <div class="small-text">Tickets asignados en proceso de resolución</div>
                    </div>
                    <div class="stat-card card-resolved">
                        <div class="stat-title">Tickets Resueltos</div>
                        <div class="stat-value" id="ticketsResueltos" th:text="${ticketsResueltos}">0</div>
                        <div class="small-text">Tickets resueltos y pendientes de cierre</div>
                    </div>
                    <div class="stat-card card-closed">
                        <div class="stat-title">Tickets Cerrados</div>
                        <div class="stat-value" id="ticketsCerrados" th:text="${ticketsCerrados}">0</div>
                        <div class="small-text">Tickets finalizados y archivados</div>
                    </div>
                    <div class="stat-card card-users">
                        <div class="stat-title">Total Usuarios</div>
                        <div class="stat-value" id="totalUsuarios" th:text="${totalUsuarios}">0</div>
                        <div class="small-text">Usuarios registrados en el sistema</div>
                    </div>
                    <div class="stat-card card-staff">
                        <div class="stat-title">Equipo de Soporte</div>
                        <div class="stat-value" id="totalColaboradores" th:text="${totalColaboradores}">0</div>
                        <div class="small-text">Usuarios soportistas y administradores activos en el sistema</div>
                    </div>
                </div>

                <!-- Gráficos -->
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Tickets por Mes</h3>
                            <div class="chart-filter">
                                <label>Período:</label>
                                <select class="chart-select" data-chart="tickets">
                                    <option value="6m">Últimos 6 meses</option>
                                    <option value="1y">Último año</option>
                                    <option value="3m">Último trimestre</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="ticketsChart"></canvas>
                        </div>
                        <div id="ticketsPeriodInfo" class="period-info">Mostrando últimos 6 meses</div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Estado de Tickets</h3>
                            <div class="chart-filter">
                                <label>Período:</label>
                                <select class="chart-select" data-chart="status">
                                    <option value="6m">Últimos 6 meses</option>
                                    <option value="1y">Último año</option>
                                    <option value="3m">Último trimestre</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="statusChart"></canvas>
                        </div>
                        <div id="statusPeriodInfo" class="period-info">Mostrando últimos 6 meses</div>
                    </div>
                </div>

                <!-- Historial de actividad -->
                <div class="activity-container">
                    <h3 class="activity-title">Historial de Auditoria</h3>
                    <p class="p-header">Registro de auditoria de las ultimas 50 acciones más recientes sobre los tickets, incluyendo creación, 
                        cambios de estado, asignaciones y respuestas, etc...</p>
                    <ul class="activity-list">
                        <li class="activity-item" th:each="actividad : ${historialAuditoria}">
                            <div class="activity-icon">
                                <i th:class="'fas ' + ${actividad.icono}"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-action" th:text="${actividad.accion}">Acción</div>
                                <div class="activity-meta">
                                    <span th:text="${actividad.usuario}">Usuario</span>
                                    <span th:text="${actividad.tiempo}">Tiempo</span>
                                    <span th:if="${actividad.infoTicket}" th:text="' | ' + ${actividad.infoTicket}">Ticket</span>
                                </div>
                                <div class="activity-details" th:if="${actividad.detalle}">
                                    <span th:text="${actividad.detalle}">Detalles</span>
                                </div>
                            </div>
                        </li>
                        <li class="activity-item no-activity" th:if="${#lists.isEmpty(historialAuditoria)}">
                            <div class="activity-icon">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-action">No hay actividad reciente</div>
                                <div class="activity-meta">
                                    <span>Sistema</span>
                                    <span>-</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Tablas de datos -->
                <div class="tables-container">
                    <div class="table-card">
                        <h3 class="table-title">Categorías más solicitadas</h3>
                        <p class="p-header">Distribución de tickets según categorías de servicio</p>
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Categoría</th>
                                        <th>Cantidad</th>
                                    </tr>
                                </thead>
                                <tbody id="categoriasTbody" class="scrollable-tbody">
                                    <tr th:each="categoria : ${categoriasPopulares}">
                                        <td th:text="${categoria.key}">Categoría</td>
                                        <td th:text="${categoria.value}">0</td>
                                    </tr>
                                    <tr th:if="${#maps.isEmpty(categoriasPopulares)}">
                                        <td colspan="2" class="no-data">No hay datos disponibles</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="table-card">
                        <h3 class="table-title">Colaboradores del Equipo de Soporte</h3>
                        <p class="p-header">Listado del equipo de soporte basado en tickets resueltos</p>
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Colaborador</th>
                                        <th>Tickets Resueltos</th>
                                    </tr>
                                </thead>
                                <tbody id="colaboradoresTbody" class="scrollable-tbody">
                                    <tr th:each="colaborador : ${colaboradoresActivos}">
                                        <td th:text="${colaborador.key}">Colaborador</td>
                                        <td th:text="${colaborador.value}">0</td>
                                    </tr>
                                    <tr th:if="${#maps.isEmpty(colaboradoresActivos)}">
                                        <td colspan="2" class="no-data">No hay colaboradores registrados</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
        </section>
    </body>
</html>