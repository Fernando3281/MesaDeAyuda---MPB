<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:th="http://www.thymeleaf.org">
    <head th:replace="~{layout/plantilla :: head}">
        <title>Mesa de Ayuda</title>
    </head>
    
    <body>
        <section th:fragment="historial">
            <div class="ticket-list-container">
                <div class="ticket-list-header">
                    <div class="header-left">
                        <h2>Historial de Tickets</h2>
                        <div class="ticket-counter">
                            <span class="counter-number" id="ticketCounter">0</span>
                            <span class="counter-label">tickets disponibles</span>
                        </div>
                    </div>
                    <div class="search-filter">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="searchInput" placeholder="Buscar por título, ID o descripción...">
                        </div>
                    </div>
                </div>

                <div class="active-filters" id="activeFilters">
                    <!-- Filtros Activos -->
                </div>

                <div class="filter-bar">
                    <div class="filter-chips">
                        <div class="filter-chip" data-filter="status">
                            <span>Estado</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="filter-chip" data-filter="priority">
                            <span>Prioridad</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="filter-chip" data-filter="category">
                            <span>Categoría</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="filter-chip" data-filter="date">
                            <span>Fecha</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                    <button class="button clear-filters" id="clearFilters">
                        Limpiar filtros
                    </button>
                </div>

                <!-- Filter Dropdowns -->
                <div class="filter-dropdown" id="statusFilter">
                    <div class="dropdown-content">
                        <label><input type="checkbox" name="status" value="abierto" checked> Abierto</label>
                        <label><input type="checkbox" name="status" value="en-proceso" checked> En Proceso</label>
                        <label><input type="checkbox" name="status" value="cerrado" checked> Cerrado</label>
                    </div>
                </div>

                <div class="filter-dropdown" id="priorityFilter">
                    <div class="dropdown-content">
                        <label><input type="checkbox" name="priority" value="alta" checked> Alta</label>
                        <label><input type="checkbox" name="priority" value="media" checked> Media</label>
                        <label><input type="checkbox" name="priority" value="baja" checked> Baja</label>
                    </div>
                </div>

                <div class="filter-dropdown" id="categoryFilter">
                    <div class="dropdown-content">
                        <label><input type="checkbox" name="category" value="hardware" checked> Hardware</label>
                        <label><input type="checkbox" name="category" value="software" checked> Software</label>
                        <label><input type="checkbox" name="category" value="redes" checked> Redes</label>
                        <label><input type="checkbox" name="category" value="sistemas" checked> Sistemas</label>
                    </div>
                </div>

                <div class="filter-dropdown" id="dateFilter">
                    <div class="dropdown-content date-range">
                        <div class="date-input-group">
                            <label>Desde:</label>
                            <input type="date" id="dateFrom">
                        </div>
                        <div class="date-input-group">
                            <label>Hasta:</label>
                            <input type="date" id="dateTo">
                        </div>
                        <button class="button apply-date">Aplicar</button>
                    </div>
                </div>

                <div class="ticket-list" id="ticketList">
                    <div th:each="ticket : ${tickets}" class="ticket-card" 
                         th:data-id="${ticket.codigo}" 
                         th:data-priority="${ticket.prioridad}" 
                         th:data-category="${ticket.categoria}" 
                         th:data-status="${ticket.estado}">
                        <div class="ticket-meta">
                            <div class="ticket-header">
                                <span class="ticket-id">
                                    <i class="fas fa-ticket"></i>
                                    <span th:text="${'#' + ticket.codigo}">TIC001</span>
                                </span>
                                <div class="ticket-tags">
                                    <span class="status" 
                                          th:classappend="${'status-' + ticket.estado.toLowerCase().replace(' ', '-')}" 
                                          th:text="${ticket.estado == 'Abierto' ? 'En Revisión' 
                                          : (ticket.estado == 'Pendiente' ? 'En Progreso' 
                                          : (ticket.estado == 'Resuelto' ? 'Solucionado' 
                                          : ticket.estado))}">
                                        Estado
                                    </span>
                                    <span class="priority priority-high" th:classappend="${'priority-' + ticket.prioridad}" th:text="${ticket.prioridad}">Prioridad</span>
                                </div>
                            </div>
                            <span class="date" th:text="${#dates.format(ticket.fechaApertura, 'dd-MM-yyyy')}">24-08-2024</span>
                        </div>
                        <div class="ticket-content">
                            <h3 th:text="${ticket.titulo}">Título del Ticket</h3>
                            <p th:text="${ticket.descripcion != null ? (#strings.length(ticket.descripcion) > 100 ? #strings.substring(ticket.descripcion,0,100) + '...' : ticket.descripcion) : ''}">Descripción del ticket...</p>
                        </div>
                        <div class="ticket-footer">
                            <div class="category-tag">
                                <i class="fas fa-desktop"></i>
                                <span th:text="${ticket.categoria}">Categoría</span>
                            </div>
                            <div class="footer-buttons">
                                <button class="button-32" th:onclick="|window.location.href='@{/usuario/detalles(id=${ticket.idTicket})}'|">Ver Detalles</button>
                                <button class="button-32 cancel-button">Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section th:fragment="ticket-detalle">

            <div class="back-button-container" style="margin-bottom: 15px;">
                <a href="javascript:void(0);" onclick="window.history.back();" class="btn btn-outline-secondary back-button">
                    <i class="fa-solid fa-arrow-left"></i>
                </a>
            </div>

            <div class="main-container">
                <div class="ticket-details">
                    <div class="ticket-header">
                        <div class="ticket-id">#TIC00000002</div>
                        <span class="status"><i class="far fa-clock"></i> En Revisión</span>
                    </div>
                    <div class="ticket-title">No me funciona el sistema de facturación</div>
                    <p class="ticket-description">
                        Estoy experimentando problemas con el sistema de facturación que están afectando mi capacidad
                        para realizar mis tareas diarias. Al intentar generar facturas, el sistema me muestra errores y no permite
                        completar el proceso. Esto está causando retrasos en la emisión de las facturas que los contribuyentes
                        necesitan. Además, he notado que algunos de los montos que aparecen en las facturas no coinciden
                        con los valores correctos, lo que está provocando confusión y errores en los registros.
                    </p>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Fecha de Apertura:</label>
                            <div>24 de Agosto del 2024 - 13:45:12</div>
                        </div>
                        <div class="info-item">
                            <label>Prioridad:</label>
                            <div>Sin Asignar</div>
                        </div>
                        <div class="info-item">
                            <label>Encargado:</label>
                            <div>Sin Asignar</div>
                        </div>
                        <div class="info-item">
                            <label>Ultima Fecha de Actualización:</label>
                            <div>24 de Agosto del 2024 - 13:45:12</div>
                        </div>
                        <div class="info-item">
                            <label>Categoría:</label>
                            <div>Sistemas</div>
                        </div>
                    </div>
                    <div class="attachments">
                        <span class="attachment"><i class="fas fa-paperclip"></i> Imagen1.jpg</span>
                        <span class="attachment"><i class="fas fa-paperclip"></i> Imagen2.jpg</span>
                    </div>
                    <button class="delete-button">Eliminar</button>
                </div>
                <div class="manager-info">
                    <h2>Información del Encargado</h2>
                    <div class="manager-icon"><i class="fas fa-headset"></i></div>
                    <div class="manager-status">
                        <strong>Su ticket está en revisión.</strong>
                        <p>Pronto un soportista se pondrá en contacto con usted.</p>
                    </div>
                </div>
            </div>
        </section>
    </body>
</html>