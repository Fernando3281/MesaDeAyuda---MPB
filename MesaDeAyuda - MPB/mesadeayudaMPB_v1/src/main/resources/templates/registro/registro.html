<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:th="http://www.thymeleaf.org">
    <head th:replace="~{layout/plantilla :: head}">
        <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Mesa de Ayuda</title>
                </head>
                <body class="body-registro">
                    <div class="registro-container">
                        <div class="registro-form">
                            <div class="registro-left">
                                <h1 class="h1-registro">Registrese</h1>
                                <p class="p-registro">Bienvenido a su Centro de Soporte</p>
                                <div class="registro-illustration"></div>
                                <p class="registro-description">Registrate con nosotros para acceder a nuestro servicio de soporte en línea y obtener asistencia personalizada por nuestra de la institución.</p>
                            </div>
                            <div class="registro-right">
                                <div class="municipalidad-logo"></div>
                                <form th:action="@{/registro}" method="post" class="form-elements-registro">
                                    <div class="input-group-registro">
                                        <label for="nombre">Nombre(s)</label>
                                        <input type="text" id="nombre" name="nombre" placeholder="Ingrese su nombre..." required>
                                    </div>
                                    <div class="input-group-registro">
                                        <label for="apellidos">Apellidos</label>
                                        <input type="text" id="apellidos" name="apellidos" placeholder="Ingrese sus apellidos..." required>
                                    </div>
                                    <div class="input-group-registro">
                                        <label for="departamento">Departamento</label>
                                        <select id="departamento" name="departamento" required>
                                            <option value="recursos-humanos">Recursos Humanos</option>
                                            <option value="tecnologia">Tecnología</option>
                                            <option value="administracion">Administración</option>
                                        </select>
                                    </div>
                                    <div class="input-group-registro">
                                        <label for="email">Correo Electrónico</label>
                                        <input type="email" id="email" name="correoElectronico" placeholder="Ingrese su correo institucional..." required>
                                    </div>
                                    <div class="input-group-registro">
                                        <label for="password">Contraseña</label>
                                        <input type="password" id="password" name="contrasena" placeholder="Ingrese una nueva contraseña..." required>
                                    </div>
                                    <div class="input-group-registro">
                                        <label for="confirm-password">Confirmar Contraseña</label>
                                        <input type="password" id="confirm-password" name="confirm-password" placeholder="Ingrese nuevamente la contraseña..." required>
                                    </div>

                                    <button type="submit" class="btn-crear-cuenta">Crear Cuenta</button>
                                    <a href="/tickets/login" class="link-ya-tengo-cuenta">Ya tengo una cuenta</a>
                                </form>

                                <!-- Modal -->
                                <div id="error-modal" class="modal" style="display:none;">
                                    <div class="modal-content">
                                        <span class="close" onclick="closeModal()">&times;</span>
                                        <p>Las contraseñas no coinciden. Por favor, inténtelo de nuevo.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <footer>
                        © 2024 Municipalidad de Barva. Todos los derechos reservados.
                    </footer>

                    <script>
                        $(document).ready(function () {
                            $("#verificationForm").submit(function (event) {
                                event.preventDefault();  // Evita que se recargue la página al enviar el formulario

                                var correoElectronico = $("input[name='correoElectronico']").val();
                                var verificationCode = $("#verificationCode").val();

                                $.ajax({
                                    url: '/verificar-registro', // Endpoint para verificar el código
                                    type: 'POST',
                                    data: {
                                        correoElectronico: correoElectronico,
                                        verificationCode: verificationCode
                                    },
                                    success: function (response) {
                                        if (response.success) {
                                            // Si la verificación es exitosa, redirigir a la página de login o mostrar un mensaje de éxito
                                            window.location.href = '/tickets/login'; // Redirige a la página de login
                                        } else {
                                            // Si el código es incorrecto, mostrar el modal con el error
                                            $("#errorMessage").text(response.errorMessage); // Actualizamos el mensaje del error
                                            $("#errorModal").show(); // Mostramos el modal
                                        }
                                    },
                                    error: function () {
                                        $("#errorMessage").text("Hubo un problema con la verificación. Inténtalo nuevamente.");
                                        $("#errorModal").show(); // Mostramos el modal si hubo un error en la solicitud
                                    }
                                });
                            });

                            // Cerrar el modal al hacer clic en el botón de cerrar
                            $("#closeModal").click(function () {
                                $("#errorModal").hide(); // Ocultar el modal
                            });

                            // Función para cerrar el modal
                            function closeModal() {
                                $("#errorModal").hide(); // Ocultar el modal
                            }
                        });
                    </script>
                </body>
                </html>

                <style>
                    .modal {
                        display: none;
                        position: fixed;
                        z-index: 1;
                        padding-top: 100px;
                        left: 0;
                        top: 0;
                        width: 100%;
                        height: 100%;
                        overflow: auto;
                        background-color: rgba(0,0,0,0.4);
                    }

                    .modal-content {
                        background-color: #fefefe;
                        margin: auto;
                        padding: 20px;
                        border: 1px solid #888;
                        width: 300px;
                        text-align: center;
                        border-radius: 8px;
                    }

                    .close {
                        color: #aaa;
                        float: right;
                        font-size: 28px;
                        font-weight: bold;
                        cursor: pointer;
                    }

                </style>
                
                
                