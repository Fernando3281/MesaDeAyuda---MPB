<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:th="http://www.thymeleaf.org">
    <head th:replace="~{layout/plantilla :: head}">
        <title>Centro de Soporte</title>
    </head>
    <body>
        <section th:fragment="mensajes-section" class="mensajes-section">
            <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
            <meta name="_csrf_token" th:content="${_csrf.token}"/>
            <input type="hidden" id="usuarioRol" th:value="${#authentication.principal.authorities}"/>

            <div class="mensajes-title">Mis Mensajes</div>

            <div class="mensajes-content">
                <!-- Panel lateral con lista de tickets -->
                <div class="tickets-list">
                    <div class="ticket-search">
                        <input class="form-control" type="text" placeholder="Buscar tickets..." id="ticketSearch">
                    </div>
                    <div class="tickets-list-container">
                        <div th:if="${tickets.empty}" class="no-messages-container">
                            <i class="fas fa-inbox no-messages-icon"></i>
                            <h3 class="no-messages-title">No tienes tickets</h3>
                            <p class="no-messages-description">
                                Actualmente no tienes tickets con mensajes. Cuando crees o recibas un ticket, 
                                aparecerá en esta sección.
                            </p>
                            <a th:href="@{/tickets/nuevo}" class="no-messages-action">
                                <i class="fas fa-plus"></i> Crear nuevo ticket
                            </a>
                        </div>
                        <div class="ticket-item" 
                             th:each="ticket : ${tickets}"
                             th:id="'ticket-' + ${ticket.idTicket}"
                             th:onclick="'loadMessages(' + ${ticket.idTicket} + ', this)'">
                            <span class="ticket-code" th:text="${ticket.codigo}">TICKET-001</span>
                            <span class="ticket-title" th:text="${ticket.titulo}">Problema con impresora</span>
                            <div class="ticket-metadata">
                                <span class="ticket-status" th:text="${ticket.estado}">Estado</span>
                                <span class="ticket-date" th:text="${#dates.format(ticket.fechaActualizacion, 'dd/MM/yyyy')}">01/01/2025</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Área de visualización de mensajes -->
                <div class="messages-area" id="messagesArea">
                    <!-- Header que se oculta/muestra dinámicamente -->
                    <div class="messages-header" id="messagesHeader" style="display: none;">
                        <h2 class="ticket-title-main" id="ticketTitleMain">Título del Ticket</h2>
                        <div class="ticket-details" id="ticketDetails">
                            <span>Estado: <strong id="ticketStatus">Estado</strong></span>
                            <span>Prioridad: <strong id="ticketPriority">Prioridad</strong></span>
                            <span>Categoría: <strong id="ticketCategory">Categoría</strong></span>
                        </div>
                    </div>

                    <div class="messages-list" id="messagesList">
                        <div class="no-messages-container" id="noMessagesPlaceholder" style="display: none;">
                            <i class="fas fa-comment-dots no-messages-icon"></i>
                            <h3 class="no-messages-title">No hay mensajes en este ticket</h3>
                            <p class="no-messages-description">
                                Sé el primero en enviar un mensaje para iniciar la conversación sobre este ticket.
                            </p>
                        </div>
                    </div>

                    <div id="noSelectionPlaceholder">
                        <div class="no-messages-container">
                            <i class="fas fa-comments no-messages-icon"></i>
                            <h3 class="no-messages-title">Selecciona un ticket</h3>
                            <p class="no-messages-description">
                                Selecciona un ticket de la lista lateral para ver los mensajes 
                                correspondientes y continuar la conversación.
                            </p>
                        </div>
                    </div>

                    <!-- Área de entrada de mensajes -->
                    <div class="message-input-area" id="messageInputArea" style="display: none;">
                        <div class="message-input-container">
                            <textarea id="messageInput" class="form-control message-input" placeholder="Escribe tu mensaje aquí..." rows="1"></textarea>
                            <button id="sendButton" class="btn send-button">Enviar</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </body>
</html>